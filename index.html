<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PRUEBA DEFINITIVA</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: #333;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            font-family: Arial, sans-serif;
            color: white;
        }
        canvas {
            border: 2px solid #555;
            background-color: #6B8E23; /* Verde olivo para el campo */
        }
        #ui {
            margin-bottom: 10px; /* Espacio entre UI y canvas */
            font-size: 1.2em;
            background-color: rgba(0,0,0,0.5);
            padding: 10px;
            border-radius: 5px;
            text-align: center;
            min-width: 300px;
        }
        #gameOverScreen, #levelCompleteScreen {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0,0,0,0.8);
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            display: none; /* Oculto por defecto */
            z-index: 100;
        }
        #gameOverScreen h2, #levelCompleteScreen h2 {
            margin-top: 0;
        }
        button { /* Estilo base para todos los botones */
            padding: 10px 20px;
            font-size: 1em;
            cursor: pointer;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            margin: 5px; /* Margen para botones individuales */
        }
        button:hover {
            background-color: #45a049;
        }
        button:active {
            background-color: #3e8e41;
        }

        #controls {
            margin-top: 10px;
            display: grid;
            grid-template-columns: repeat(3, 1fr); /* 3 columnas */
            grid-template-areas: 
                ". btn-up ."
                "btn-left btn-shoot btn-right"
                "btn-tleft btn-down btn-tright";
            gap: 5px;
            max-width: 300px; /* Ancho máximo para el panel de control */
        }

        #controls button {
            padding: 12px;
            font-size: 0.9em;
            min-width: 80px; /* Ancho mínimo para botones de control */
        }
        
        /* Asignar botones a áreas del grid */
        #btnUp { grid-area: btn-up; }
        #btnLeft { grid-area: btn-left; }
        #btnShoot { 
            grid-area: btn-shoot; 
            background-color: #f44336; /* Rojo para disparar */
        }
        #btnShoot:hover { background-color: #d32f2f; }
        #btnShoot:active { background-color: #b71c1c; }
        #btnRight { grid-area: btn-right; }
        #btnTurretLeft { grid-area: btn-tleft; }
        #btnDown { grid-area: btn-down; }
        #btnTurretRight { grid-area: btn-tright; }

    </style>
</head>
<body>
    <h1>!!! ESTA ES UNA PRUEBA DE CAMBIO VISIBLE !!!</h1>
    <div id="ui">
        Puntos: <span id="score">0</span> |
        Nivel: <span id="level">1</span> |
        Salud: <span id="health">2000</span> | <!-- Vida duplicada, actualizada por JS -->
        Enemigos restantes: <span id="enemiesLeft">0</span>
    </div>
    <canvas id="gameCanvas"></canvas>

    <div id="controls">
        <button id="btnUp">▲<br>Avanzar</button>
        <button id="btnLeft">◄<br>Girar Cuerpo Izq</button>
        <button id="btnShoot">◉<br>Disparar</button>
        <button id="btnRight">►<br>Girar Cuerpo Der</button>
        <button id="btnTurretLeft">◣<br>Torreta Izq</button>
        <button id="btnDown">▼<br>Retroceder</button>
        <button id="btnTurretRight">◢<br>Torreta Der</button>
    </div>
    
    <div id="gameOverScreen">
        <h2>¡Juego Terminado!</h2>
        <p>Puntuación Final: <span id="finalScore">0</span></p>
        <button onclick="restartGame()">Reiniciar Juego</button>
    </div>

    <div id="levelCompleteScreen">
        <h2>¡Nivel Completado!</h2>
        <p>Puntuación: <span id="levelScore">0</span></p>
        <button onclick="nextLevel()">Siguiente Nivel</button>
    </div>

    <!-- --- INDICADOR DE RECARGA DE DISPARO --- -->
    <div id="shootCooldownBar" style="width: 300px; height: 12px; background: #222; border: 1px solid #555; border-radius: 6px; margin: 10px auto 0 auto; overflow: hidden; position: relative; display: block;">
        <div id="shootCooldownFill" style="height: 100%; background: linear-gradient(90deg, #f44336, #4caf50); width: 100%; transition: width 0.1s linear;"></div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // Elementos UI
        const scoreEl = document.getElementById('score');
        const levelEl = document.getElementById('level');
        const healthEl = document.getElementById('health');
        const enemiesLeftEl = document.getElementById('enemiesLeft');
        
        const gameOverScreen = document.getElementById('gameOverScreen');
        const finalScoreEl = document.getElementById('finalScore');
        const levelCompleteScreen = document.getElementById('levelCompleteScreen');
        const levelScoreEl = document.getElementById('levelScore');

        // Botones de control
        const btnUp = document.getElementById('btnUp');
        const btnDown = document.getElementById('btnDown');
        const btnLeft = document.getElementById('btnLeft');
        const btnRight = document.getElementById('btnRight');
        const btnTurretLeft = document.getElementById('btnTurretLeft');
        const btnTurretRight = document.getElementById('btnTurretRight');
        const btnShoot = document.getElementById('btnShoot');

        // Variables del juego
        let score = 0;
        let level = 1;
        let health = 2000;
        let enemiesLeft = 0;
        let shootCooldown = 0;

        // Clases del juego
        class Tank {
            constructor(x, y, width, height, color) {
                this.x = x;
                this.y = y;
                this.width = width;
                this.height = height;
                this.color = color;
                this.health = 100;
                this.alive = true;
            }

            draw() {
                if (this.alive) {
                    ctx.fillStyle = this.color;
                    ctx.fillRect(this.x, this.y, this.width, this.height);
                }
            }

            move(dx, dy) {
                this.x += dx;
                this.y += dy;
            }

            rotate(angle) {
                // Lógica de rotación
            }

            shoot() {
                if (shootCooldown === 0) {
                    projectiles.push(new Projectile(this.x + this.width / 2, this.y, 5, 'red'));
                    shootCooldown = 20; // Tiempo de recarga
                }
            }

            update() {
                if (this.health <= 0) {
                    this.alive = false;
                }
                this.draw();
            }
        }

        class Enemy extends Tank {
            constructor(x, y) {
                super(x, y, 50, 50, 'green');
                this.speed = 2;
            }

            // Comportamiento específico de los enemigos
            update() {
                super.update();
                // Lógica de movimiento y disparo de enemigos
            }
        }

        class Projectile {
            constructor(x, y, speed, color) {
                this.x = x;
                this.y = y;
                this.speed = speed;
                this.color = color;
                this.alive = true;
            }

            draw() {
                if (this.alive) {
                    ctx.fillStyle = this.color;
                    ctx.fillRect(this.x, this.y, 5, 5);
                }
            }

            update() {
                this.y -= this.speed;
                if (this.y < 0) {
                    this.alive = false;
                }
                this.draw();
            }
        }

        class Obstacle {
            constructor(x, y, width, height) {
                this.x = x;
                this.y = y;
                this.width = width;
                this.height = height;
            }

            draw() {
                ctx.fillStyle = 'brown';
                ctx.fillRect(this.x, this.y, this.width, this.height);
            }
        }

        // Variables del juego
        let player;
        let enemies = [];
        let projectiles = [];
        let obstacles = [];

        // Funciones del juego
        function updateUI() {
            scoreEl.innerText = score;
            levelEl.innerText = level;
            healthEl.innerText = health;
            enemiesLeftEl.innerText = enemiesLeft;
        }

        function gameOver() {
            gameOverScreen.style.display = 'block';
            finalScoreEl.innerText = score;
        }

        function restartGame() {
            score = 0;
            level = 1;
            health = 2000;
            enemiesLeft = 0;
            shootCooldown = 0;
            player = new Tank(canvas.width / 2 - 25, canvas.height - 60, 50, 50, 'blue');
            enemies = [];
            projectiles = [];
            obstacles = [];
            updateUI();
            gameOverScreen.style.display = 'none';
            // Reiniciar lógica del juego...
        }

        function nextLevel() {
            level++;
            enemiesLeft = level * 10; // Aumentar enemigos con el nivel
            updateUI();
            levelCompleteScreen.style.display = 'none';
            // Lógica para iniciar el siguiente nivel...
        }

        function handleCollisions() {
            // Colisiones entre proyectiles y enemigos
            projectiles.forEach((proj, pIndex) => {
                enemies.forEach((enemy, eIndex) => {
                    if (proj.x < enemy.x + enemy.width &&
                        proj.x + 5 > enemy.x &&
                        proj.y < enemy.y + enemy.height &&
                        proj.y + 5 > enemy.y) {
                        // Colisión detectada
                        enemy.health -= 10;
                        proj.alive = false;
                        if (enemy.health <= 0) {
                            enemy.alive = false;
                            score += 100;
                            enemiesLeft--;
                        }
                    }
                });
            });

            // Colisiones entre tanques y obstáculos
            // (Lógica para manejar colisiones con obstáculos)
        }

        // Lógica del juego
        function gameLoop() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Actualizar y dibujar elementos del juego
            player.update();
            projectiles.forEach((proj, index) => {
                proj.update();
                if (!proj.alive) {
                    projectiles.splice(index, 1);
                }
            });
            enemies.forEach((enemy, index) => {
                enemy.update();
                if (!enemy.alive) {
                    enemies.splice(index, 1);
                }
            });
            obstacles.forEach(obstacle => {
                obstacle.draw();
            });

            handleCollisions();

            requestAnimationFrame(gameLoop);
        }

        // Inicialización
        player = new Tank(canvas.width / 2 - 25, canvas.height - 60, 50, 50, 'blue');
        for (let i = 0; i < 5; i++) {
            enemies.push(new Enemy(Math.random() * canvas.width, Math.random() * canvas.height / 2));
        }
        obstacles.push(new Obstacle(200, 300, 100, 20));
        updateUI();
        gameLoop();

        // Controles
        btnUp.addEventListener('click', () => player.move(0, -5));
        btnDown.addEventListener('click', () => player.move(0, 5));
        btnLeft.addEventListener('click', () => player.move(-5, 0));
        btnRight.addEventListener('click', () => player.move(5, 0));
        btnShoot.addEventListener('click', () => player.shoot());

        // --- AQUÍ TERMINA EL JUEGO COMPLETO ---
    </script>
</body>
</html>